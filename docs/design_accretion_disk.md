# 吸积盘模拟设计文档

## 1. 物理背景

### 1.1 吸积盘基本结构

黑洞吸积盘是环绕黑洞旋转的高温气体盘，主要特征：

- **ISCO（最内稳定圆轨道）**：大约 3-6 倍史瓦西半径，是吸积盘内边界
- **差动旋转**：内圈快外圈慢（开普勒速度 `ω ∝ r^(-3/2)`）
- **温度梯度**：内圈更热、更亮

### 1.2 旋臂问题

**问：黑洞吸积盘会有旋臂吗？**

答：会，但与星系旋臂不同——它们是**瞬态的**，由不稳定性触发。

| 特征 | 星系旋臂 | 黑洞吸积盘 |
|------|---------|-----------|
| 寿命 | 数十亿年 | 数天-数年 |
| 维持机制 | 密度波理论 | 潮汐/不稳定性/粘滞 |
| 臂数 | 2-4 条 | 1-3 条（易破碎） |

**结论**：吸积盘的旋臂不应是长期稳定的结构，应呈现不规则、破碎的特征。

---

## 2. 模拟方法对比

### 2.1 物理精确模拟（科研级）

| 方法 | 描述 | 适用场景 |
|------|------|---------|
| Shakura-Sunyaev 薄盘模型 | 解析解，温度/密度分布 | 理论分析 |
| MHD 数值模拟 | 求解磁流体方程 | 科研论文 |
| SPH 粒子模拟 | 光滑粒子流体 | 大尺度演化 |

**缺点**：计算量巨大，不适合实时渲染。

---

### 2.2 视觉模拟（图形学）

| 方法 | 每帧开销 | 视觉效果 | 实现难度 |
|------|---------|---------|---------|
| 静态 FBM 噪声 | 0（预生成） | 良 | 低 |
| 预计算动画序列 | <1% | 优秀 | 中 |
| 实时 FBM 扰动 | +1-5% | 良 | 中 |
| 2D 流体纹理 | +10-50% | 优秀 | 高 |
| 粒子系统 | +10-30% | 好 | 中 |

**本项目约束**：纯 CPU 渲染，需保持帧率可用。

---

### 2.3 最终选择

采用**静态纹理 + 扰动**方案：

1. **程序化生成**：极坐标下直接生成纹理，避免接缝
2. **多尺度噪声**：FBM 产生云雾效果
3. **旋臂**：2-4 条主臂，加入噪声使其不规则
4. **内边界特殊处理**：RT 不稳定性产生热点
5. **动态效果**：通过渲染时的相位偏移模拟旋转

---

## 3. 当前实现详解

### 3.1 纹理坐标系

```python
# 极坐标参数
phi: 0 → 2π（角度方向）
r: r_inner → r_outer（径向方向）
```

### 3.2 纹理组成

```
吸积盘密度 = 
  ├── 基础温度剖面（Novikov-Thorne）
  ├── 螺旋臂（螺旋密度波）
  ├── 云雾（FBM 噪声）
  ├── 热点（弧形亮斑）
  └── 内边界不稳定性（RT 尖峰）
```

### 3.3 各组件参数

#### 螺旋臂

```python
# 当前实现：8-15 条（偏多）
# 改进目标：2-4 条，更破碎

arm_angle = phi - base_angle - r_norm * rotations * 2 * np.pi
# rotations: 2.0-5.0 圈
# 使用噪声调制宽度和强度，使其断断续续
```

#### 云雾

```python
# 多层噪声叠加
# 使用极坐标下的噪声避免接缝
# 按面积比例分布
```

#### 热点

```python
# 15-35 个弧形亮斑
# 位于不同半径
# 强度随机
```

#### 内边界热点

```python
# 在 r_inner 附近添加 RT 不稳定性
# 产生尖峰结构
# 亮度更高
```

---

## 4. 改进计划

### 4.1 短期（高优先级）

- [ ] 减少旋臂数量（8-15 → 2-4 条）
- [ ] 增加旋臂破碎效果
- [ ] 增强内边界热点

### 4.2 中期（可选）

- [ ] 预计算 30-60 帧动画序列
- [ ] 加入时间演化的湍流

### 4.3 长期（探索）

- [ ] GPU 加速后可用 SPH 粒子
- [ ] 实时流体模拟

---

## 5. 参考资料

- Shakura, N.I., Sunyaev, R.A. (1973). Black holes in binary systems. Observational appearance.
- Interstellar scientific paper (2015). DNEG's rendering approach.
- Kim, J., et al. (2019). Warped FBM for realistic cloud rendering.